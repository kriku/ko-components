define(["knockout","utils","text!./templates/ko-form.html"],function(e,t,i){function r(t){e.components.register("input-text",{require:"ko/input-text"}),e.components.register("input-num",{require:"ko/input-num"}),e.components.register("input-check",{require:"ko/input-check"}),e.components.register("input-radio",{require:"ko/input-radio"}),e.components.register("input-select",{require:"ko/input-select"});var i=this;this.action=t.action,this.form=t.form,this.method=t.method,this.data=t.data,this.reset=t.reset,this.submit=t.submit,this.fields=e.observableArray([]),this.form instanceof Array&&this.bindFields(),"string"==typeof this.form&&this.getForm(this.form),this.resetForm=function(){this.bindFields()},this.disabled=e.computed(function(){for(var e=0,t=i.fields().length;t>e;e++)if("function"==typeof i.fields()[e].error&&i.fields()[e].error())return!0;return!1},this),this.innerData=e.computed(function(){return i.prepareForm(i.fields())},this)}var s=function(t){this.type=t.type,this.name=t.name,this.label=t.label,this.value=e.observable(t.value),this.required=t.required,this.minLength=t.minLength,this.maxLength=t.maxLength,this.error=e.observable(null)},n=function(t){this.type=t.type,this.name=t.name,this.label=t.label,this.value=e.observable(t.value),this.required=t.required},o=function(t){this.type=t.type,this.name=t.name,this.label=t.label,this.options=t.options,this.value=e.observable(t.value),this.inline=t.inline,this.required=t.required,this.error=e.observable(null)},a=function(t){this.type=t.type,this.name=t.name,this.label=t.label,this.options=t.options,this.value=e.observable(t.value),this.required=t.required,this.error=e.observable(null)};return r.prototype.getForm=function(e){var i=this,r=t.Ajax();r.onreadystatechange=function(){4==r.readyState&&200==r.status&&(i.form=JSON.parse(r.responseText),i.bindFields())},r.open("GET",e,!0),r.send()},r.prototype.prepareForm=function(e){for(var t={},i=0,r=e.length;r>i;i++)t.hasOwnProperty(this.fields()[i].name)?t[e[i].name]instanceof Array?t[e[i].name].push(e[i].value):(t[e[i].name]=new Array(t[e[i].name]),t[e[i].name].push(e[i].value)):t[e[i].name]=e[i].value;return this.data(t),t},r.prototype.bindFields=function(){this.fields([]);for(var e=this.form.length,t=0;e>t;t++)switch(this.form[t].type){case"input-text":case"input-num":this.fields.push(new s({type:this.form[t].type,name:this.form[t].name,label:this.form[t].label,value:this.form[t].value,required:this.form[t].required,minLength:this.form[t].minLength,maxLength:this.form[t].maxLength}));break;case"input-check":this.fields.push(new n({type:this.form[t].type,name:this.form[t].name,label:this.form[t].label,value:this.form[t].value}));break;case"input-radio":this.fields.push(new o({type:this.form[t].type,name:this.form[t].name,label:this.form[t].label,inline:this.form[t].inline,options:this.form[t].options,value:this.form[t].value,required:this.form[t].required}));break;case"input-select":this.fields.push(new a({type:this.form[t].type,name:this.form[t].name,label:this.form[t].label,options:this.form[t].options,value:this.form[t].value}))}},{viewModel:r,template:i}});